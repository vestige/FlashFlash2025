<!doctype html>
<html lang="ja">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Flash Flash 2025</title>
<style>
:root {
  --bg: #ffffff;
  --fg: #111111;
  --muted: #6b7280;
  --border: #e5e7eb;
  --card: #ffffff;
  --accent: #4CAF50; /* FLASH„Ç∞„É™„Éº„É≥ */
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', Helvetica, Arial, sans-serif;
  color: var(--fg);
  background: var(--bg);
}
a { color: var(--accent); text-decoration: none; }
a:hover { opacity: .85; }
header {
  position: sticky;
  top: 0;
  z-index: 10;
  background: #fff;
  border-bottom: 2px solid #4CAF50; /* Á∑ë„É©„Ç§„É≥„ÅßÂº∑Ë™ø */
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
}
.header-inner {
  max-width: 1100px;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  padding: 14px 18px;
}
.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 800;
  font-size: 20px;
  color: #111;
  letter-spacing: 0.5px;
}
.brand-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 34px;
  height: 34px;
  border-radius: 8px;
  background: #4CAF50;
  color: #fff;
  font-weight: 900;
  font-size: 18px;
}
button, .btn {
  background: var(--accent); border: 1px solid var(--accent);
  color: #fff; font-weight: 700;
  padding: 8px 14px; border-radius: 10px; cursor: pointer;
}
button:hover, .btn:hover { opacity: .9; }
.container {
  max-width: 1100px; margin: 0 auto; padding: 16px;
}
.table-wrap {
  overflow: auto; border: 1px solid var(--border); border-radius: 12px;
  box-shadow: 0 3px 10px rgba(0,0,0,.03);
}
table {
  width: 100%; border-collapse: separate; border-spacing: 0; min-width: 720px;
}
thead th {
  background: #f7f7f7; color: #111; font-weight: 800;
  border-bottom: 1px solid var(--border);
  position: sticky; top: 0;
}
th, td {
  padding: 10px 12px; text-align: left; white-space: nowrap;
  border-bottom: 1px solid #f3f4f6;
}
tbody tr:nth-child(odd) { background: #fcfcfc; }
.category {
  margin: 18px 0; padding: 14px;
  background: var(--card); border: 1px solid var(--border);
  border-radius: 14px; box-shadow: 0 2px 8px rgba(0,0,0,.03);
}
.category h2 {
  font-size: 18px; margin: 0 0 10px;
  color: var(--accent); display: flex; align-items: center; gap: 8px;
}
.badge {
  display: inline-block; padding: 2px 8px; border-radius: 999px;
  background: #E8F5E9; color: #256029;
  font-size: 12px; font-weight: 700;
  border: 1px solid #C8E6C9;
}
footer {
  color: var(--muted); font-size: 12px;
  text-align: center; margin: 40px 0 20px;
}
@media (max-width: 520px) {
  .brand { font-size: 16px; }
  table { min-width: 680px; }
}
</style>
<header class="header">
  <div class="header-inner">
    <div class="brand">
      <span class="brand-badge">F</span>
      <span>CLIMBING GYM FLASH</span>
    </div>
    <a class="back-btn" href="https://www.climbing-flash.jp/">üè† ÂÖ¨Âºè„Çµ„Ç§„Éà„Å∏Êàª„Çã</a>
  </div>
    <div class="brand">
    <div class="h1">„ÄÄFlash Flash 2025„ÄÄ</div>
      <div class="controls">
      <label>„Éá„Éº„Çø:
        <select id="source"></select>
      </label>
      <label>„Ç´„ÉÜ„Ç¥„É™:
        <select id="cat"><option>„Åô„Åπ„Å¶</option></select>
      </label>
      <input id="q" placeholder="ÂêçÂâç„Å™„Å©„ÅßÁµû„ÇäËæº„Åø‚Ä¶" />
    </div>
    <div class="source-note" id="source-note"></div>
    </div>
    <p>
</header>
<main class="wrap">
  <div id="root"></div>
  <footer></footer>
</main>
<script>
const SOURCES = {
  "FINAL": { 
    url: "final.json",
    pref: ["È†Ü‰Ωç","‰∫àÈÅ∏È†Ü‰Ωç","ÂêçÂâç","„Çª„ÉÉ„Ç∑„Éß„É≥","„Çµ„Éâ„É≥„Éá„ÇπÔºë","„Çµ„Éâ„É≥„Éá„ÇπÔºí","ÂêàË®àP","‰∫àÈÅ∏Á∑èÂêàP"]
  },
  "‰∫àÈÅ∏": { 
    url: "data.json",
    pref: ["È†Ü‰Ωç","ÂêçÂâç","Á∑èÂêàP","Á¨¨1Êà¶P","Á¨¨2Êà¶P","Á¨¨3Êà¶P"]
  }
};

let CATS = [];
let CURRENT_SOURCE = null;

async function fetchCategories(url) {
  const res = await fetch(url, { cache: "no-store" });
  if(!res.ok) throw new Error(`„Éá„Éº„ÇøÂèñÂæó„Å´Â§±Êïó: ${url} (${res.status})`);
  const data = await res.json();
  if(!data || !Array.isArray(data.categories)) {
    throw new Error("‰∏çÊ≠£„Å™„Éá„Éº„ÇøÂΩ¢ÂºèÔºàcategoriesÈÖçÂàó„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºâ");
  }
  return data.categories;
}

function orderColumns(rows, pref) {
  const present = new Set();
  rows.forEach(r => Object.keys(r).forEach(k => { if(r[k] !== "") present.add(k); }));
  const preferred = pref.filter(k => present.has(k));
  const rest = [...present].filter(k => !preferred.includes(k));
  return preferred.length ? preferred.concat(rest) : [...present];
}

function buildTable(columns, rows) {
  const table = document.createElement('table');
  const thead = document.createElement('thead');
  const thr = document.createElement('tr');
  columns.forEach(col => {
    const th = document.createElement('th');
    th.textContent = col;
    thr.appendChild(th);
  });
  thead.appendChild(thr);
  table.appendChild(thead);
  const tbody = document.createElement('tbody');
  rows.forEach(r => {
    const tr = document.createElement('tr');
    columns.forEach(c => {
      const td = document.createElement('td');
      td.textContent = r[c] ?? "";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  return table;
}

function render(pref, q="") {
  const root = document.getElementById('root');
  root.innerHTML = "";
  const query = q.trim();
  const catSel = document.getElementById('cat');
  const pick = catSel.value;
  const cats = (pick && pick !== '„Åô„Åπ„Å¶') ? CATS.filter(c => c.name === pick) : CATS;
  cats.forEach(cat => {
    const rows = cat.results || [];
    if(query){
      const hit = rows.some(r => Object.values(r).some(v => String(v).includes(query)));
      if(!hit) return;
    }
    const columns = orderColumns(rows, pref);
    const box = document.createElement('section');
    box.className = 'category';
    const h2 = document.createElement('h2');
    h2.innerHTML = `${cat.name} <span class="badge">${rows.length}Âêç</span>`;
    box.appendChild(h2);
    const wrap = document.createElement('div');
    wrap.className = 'table-wrap';
    wrap.appendChild(buildTable(columns, rows));
    box.appendChild(wrap);
    root.appendChild(box);
  });
}

function populateCategorySelect() {
  const catSel = document.getElementById('cat');
  const current = catSel.value; // keep current selection if possible
  catSel.innerHTML = "";
  const names = ['„Åô„Åπ„Å¶', ...CATS.map(c => c.name)];
  names.forEach(n => {
    const opt = document.createElement('option');
    opt.value = n; opt.textContent = n;
    catSel.appendChild(opt);
  });
  if (names.includes(current)) catSel.value = current;
  else catSel.value = '„Åô„Åπ„Å¶';
}

async function reloadSource() {
  const sourceSel = document.getElementById('source');
  const sourceNote = document.getElementById('source-note');
  const search = document.getElementById('q');
  const sKey = sourceSel.value;
  const src = SOURCES[sKey];
  CURRENT_SOURCE = sKey;
//  sourceNote.textContent = `Ë°®Á§∫„Éá„Éº„Çø: ${src.url}`;
  CATS = await fetchCategories(src.url);
  populateCategorySelect();
  render(src.pref, search.value);
}

document.addEventListener('DOMContentLoaded', async () => {
  const sourceSel = document.getElementById('source');
  const catSel = document.getElementById('cat');
  const search = document.getElementById('q');

  Object.keys(SOURCES).forEach(name => {
    const opt = document.createElement('option');
    opt.value = name; opt.textContent = name;
    sourceSel.appendChild(opt);
  });
  sourceSel.value = Object.keys(SOURCES)[0];

  sourceSel.addEventListener('change', reloadSource);
  catSel.addEventListener('change', () => {
    const pref = SOURCES[CURRENT_SOURCE].pref;
    render(pref, search.value);
  });
  search.addEventListener('input', () => {
    const pref = SOURCES[CURRENT_SOURCE].pref;
    render(pref, search.value);
  });

  await reloadSource();
});
</script>
</html>
