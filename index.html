<!doctype html>
<html lang="ja">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Flash Flash 2025</title>
<style>
/* ========== Theme tokens ========== */
:root{
  --bg:#ffffff; --fg:#111111; --muted:#6b7280;
  --border:#e5e7eb; --card:#ffffff; --accent:#4CAF50; /* FLASH green */
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Hiragino Kaku Gothic ProN','Noto Sans JP',Helvetica,Arial,sans-serif;
  color:var(--fg); background:var(--bg);
}
a{color:var(--accent); text-decoration:none}
a:hover{opacity:.85}

/* ========== Header ========== */
header{
  position:sticky; top:0; z-index:10;
  background:#fff; border-bottom:2px solid var(--accent);
  box-shadow:0 2px 6px rgba(0,0,0,.05);
}
.header-inner{
  width:100%; margin:0;
  display:flex; align-items:center; justify-content:space-between; /* 右端に戻るボタン */
  gap:12px; padding:14px 12px; /* 完全に端なら 0 に */
}
.brand{
  display:flex; align-items:center; gap:10px;
  font-weight:800; font-size:20px; color:#111; letter-spacing:.5px;
}
.brand-badge{
  display:inline-flex; align-items:center; justify-content:center;
  width:34px; height:34px; border-radius:8px;
  background:var(--accent); color:#fff; font-weight:900; font-size:18px;
}
.back-btn{
  background:var(--accent); color:#fff; font-weight:700;
  padding:8px 14px; border-radius:10px; border:1px solid var(--accent);
  transition:.2s;
}
.back-btn:hover{ background:#43A047; border-color:#43A047 }

/* ========== Layout helpers ========== */
.container{max-width:1100px; margin:0 auto; padding:16px}
.wrap{max-width:1100px; margin:0 auto; padding:16px}

/* ========== Controls (カテゴリ/検索/セレクト) ========== */
.controls{display:flex; gap:12px; flex-wrap:wrap; align-items:center}

/* 丸くて大きめ（確実に効くよう強めのセレクタも併用） */
select,
input[type="text"],
input[type="search"],
.controls select,
.controls input[type="text"],
.controls input[type="search"],
#q{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  font-size:15px; line-height:1.3;
  padding:12px 16px;
  border:1.5px solid #d1d5db;
  border-radius:14px;
  background:#fff; color:#111;
  box-shadow:0 1px 3px rgba(0,0,0,.04);
  transition:all .2s ease;
  height:46px; min-height:46px; /* ← 高さを明示 */
  box-sizing:border-box;
}

/* プルダウン矢印（Chrome/Safari） */
select{
  background-image:url('data:image/svg+xml;utf8,<svg fill="%234CAF50" height="24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
  background-repeat:no-repeat; background-position:right 12px center; background-size:18px 18px;
  padding-right:40px;
}

/* フォーカス（FLASHグリーン） */
select:focus,
input:focus,
.controls select:focus,
.controls input:focus,
#q:focus{
  outline:none; border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(76,175,80,.2);
}

/* Safariのsearch固有UIを無効化 */
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration{ -webkit-appearance:none }

/* ========== Category blocks & table ========== */
.category{
  margin:18px 0; padding:14px; background:var(--card);
  border:1px solid var(--border); border-radius:14px; box-shadow:0 2px 8px rgba(0,0,0,.03)
}
.category h2{
  font-size:18px; margin:0 0 10px; color:var(--accent);
  display:flex; align-items:center; gap:8px;
}
.badge{
  display:inline-block; padding:2px 8px; border-radius:999px;
  background:#E8F5E9; color:#256029; font-size:12px; font-weight:700; border:1px solid #C8E6C9
}
.table-wrap{overflow:auto; border:1px solid var(--border); border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,.03)}
table{width:100%; border-collapse:separate; border-spacing:0; min-width:720px}
thead th{
  background:#f7f7f7; color:#111; font-weight:800;
  border-bottom:1px solid var(--border); position:sticky; top:0;
}
th,td{
  padding:10px 12px; text-align:left; white-space:nowrap; border-bottom:1px solid #f3f4f6
}
tbody tr:nth-child(odd){background:#fcfcfc}

/* ========== Footer ========== */
footer{color:var(--muted); font-size:12px; text-align:center; margin:40px 0 20px}

/* ========== Responsive ========== */
@media (max-width:600px){
  .brand{font-size:16px}
  table{min-width:680px}
  select, input[type="text"], input[type="search"], #q{
    font-size:16px; padding:13px 16px; border-radius:16px; height:50px; min-height:50px;
  }
}
</style>
<header class="header">
  <div class="header-inner">
    <div class="brand">
      <span class="brand-badge">F</span>
      <span>CLIMBING GYM FLASH</span>
    </div>
    <a class="back-btn" href="https://www.climbing-flash.jp/">🏠 公式サイトへ戻る</a>
  </div>
    <div class="brand">
    <div class="h1">　Flash Flash 2025　</div>
      <div class="controls">
      <label>データ:
        <select id="source"></select>
      </label>
      <label>カテゴリ:
        <select id="cat"><option>すべて</option></select>
      </label>
      <input id="q" placeholder="名前などで絞り込み…" />
    </div>
    <div class="source-note" id="source-note"></div>
    </div>
    <p>
</header>
<main class="wrap">
  <div id="root"></div>
  <footer></footer>
</main>
<script>
const SOURCES = {
  "FINAL": { 
    url: "final.json",
    pref: ["順位","予選順位","名前","セッション","サドンデス１","サドンデス２","合計P","予選総合P"]
  },
  "予選": { 
    url: "data.json",
    pref: ["順位","名前","総合P","第1戦P","第2戦P","第3戦P"]
  }
};

let CATS = [];
let CURRENT_SOURCE = null;

async function fetchCategories(url) {
  const res = await fetch(url, { cache: "no-store" });
  if(!res.ok) throw new Error(`データ取得に失敗: ${url} (${res.status})`);
  const data = await res.json();
  if(!data || !Array.isArray(data.categories)) {
    throw new Error("不正なデータ形式（categories配列がありません）");
  }
  return data.categories;
}

function orderColumns(rows, pref) {
  const present = new Set();
  rows.forEach(r => Object.keys(r).forEach(k => { if(r[k] !== "") present.add(k); }));
  const preferred = pref.filter(k => present.has(k));
  const rest = [...present].filter(k => !preferred.includes(k));
  return preferred.length ? preferred.concat(rest) : [...present];
}

function buildTable(columns, rows) {
  const table = document.createElement('table');
  const thead = document.createElement('thead');
  const thr = document.createElement('tr');
  columns.forEach(col => {
    const th = document.createElement('th');
    th.textContent = col;
    thr.appendChild(th);
  });
  thead.appendChild(thr);
  table.appendChild(thead);
  const tbody = document.createElement('tbody');
  rows.forEach(r => {
    const tr = document.createElement('tr');
    columns.forEach(c => {
      const td = document.createElement('td');
      td.textContent = r[c] ?? "";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
  return table;
}

function render(pref, q="") {
  const root = document.getElementById('root');
  root.innerHTML = "";
  const query = q.trim();
  const catSel = document.getElementById('cat');
  const pick = catSel.value;
  const cats = (pick && pick !== 'すべて') ? CATS.filter(c => c.name === pick) : CATS;
  cats.forEach(cat => {
    const rows = cat.results || [];
    if(query){
      const hit = rows.some(r => Object.values(r).some(v => String(v).includes(query)));
      if(!hit) return;
    }
    const columns = orderColumns(rows, pref);
    const box = document.createElement('section');
    box.className = 'category';
    const h2 = document.createElement('h2');
    h2.innerHTML = `${cat.name} <span class="badge">${rows.length}名</span>`;
    box.appendChild(h2);
    const wrap = document.createElement('div');
    wrap.className = 'table-wrap';
    wrap.appendChild(buildTable(columns, rows));
    box.appendChild(wrap);
    root.appendChild(box);
  });
}

function populateCategorySelect() {
  const catSel = document.getElementById('cat');
  const current = catSel.value; // keep current selection if possible
  catSel.innerHTML = "";
  const names = ['すべて', ...CATS.map(c => c.name)];
  names.forEach(n => {
    const opt = document.createElement('option');
    opt.value = n; opt.textContent = n;
    catSel.appendChild(opt);
  });
  if (names.includes(current)) catSel.value = current;
  else catSel.value = 'すべて';
}

async function reloadSource() {
  const sourceSel = document.getElementById('source');
  const sourceNote = document.getElementById('source-note');
  const search = document.getElementById('q');
  const sKey = sourceSel.value;
  const src = SOURCES[sKey];
  CURRENT_SOURCE = sKey;
//  sourceNote.textContent = `表示データ: ${src.url}`;
  CATS = await fetchCategories(src.url);
  populateCategorySelect();
  render(src.pref, search.value);
}

document.addEventListener('DOMContentLoaded', async () => {
  const sourceSel = document.getElementById('source');
  const catSel = document.getElementById('cat');
  const search = document.getElementById('q');

  Object.keys(SOURCES).forEach(name => {
    const opt = document.createElement('option');
    opt.value = name; opt.textContent = name;
    sourceSel.appendChild(opt);
  });
  sourceSel.value = Object.keys(SOURCES)[0];

  sourceSel.addEventListener('change', reloadSource);
  catSel.addEventListener('change', () => {
    const pref = SOURCES[CURRENT_SOURCE].pref;
    render(pref, search.value);
  });
  search.addEventListener('input', () => {
    const pref = SOURCES[CURRENT_SOURCE].pref;
    render(pref, search.value);
  });

  await reloadSource();
});
</script>
</html>
